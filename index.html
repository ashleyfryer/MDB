<!DOCTYPE html>

<!--
File Name: index.html
Project: The Movie Database API
Date: 5/29/18
Programmer: MDB Group
-->

<html>

<head>

<!--Codes page as mobile first-->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8">
    
<title>The Movie Database Project</title>
    
<link href="styles/style.css" rel="stylesheet">
<link href="styles/grid.css" rel="stylesheet">
    
 <!--JQuery Library-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <!--Fetch Movie Database API Info-->
    <script>
        
        var imageurlsmall = "https://image.tmdb.org/t/p/w200";
        var urlimglarge = "https://image.tmdb.org/t/p/w500"
        
        function getInput() {
            var query = $('#search').val();
            return query;
        }
        
        function nowPlaying() {
             var xhr = new XMLHttpRequest();
             xhr.open("GET", "https://api.themoviedb.org/3/movie/now_playing?api_key=3daaa224d520ad43baab7a6b2c604dca&language=en-US&page=1", false);
             xhr.send();
            console.log(xhr.status); // if this returns 200, then you are in like Flynn
            var moviePopular = JSON.parse(xhr.responseText);
            console.log(moviePopular);
            
            $("#popular").text(moviePopular.results["0"].original_title);
            $("#popularimg").attr("src", imageurlsmall + moviePopular.results["0"].poster_path);
            $("#popular1").text(moviePopular.results["1"].original_title);
            $("#popular1img").attr("src", imageurlsmall + moviePopular.results["1"].poster_path);
            $("#popular2").text(moviePopular.results["2"].original_title);
            $("#popular2img").attr("src", imageurlsmall + moviePopular.results["2"].poster_path);
            $("#popular3").text(moviePopular.results["3"].original_title);
            $("#popular3img").attr("src", imageurlsmall + moviePopular.results["3"].poster_path);
            $("#popular4").text(moviePopular.results["4"].original_title);
            $("#popular4img").attr("src", imageurlsmall + moviePopular.results["4"].poster_path);
        }
        
        function recommendMovie(movie) {
            var movieID = movie.results["0"].id;
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://api.themoviedb.org/3/movie/" + movieID + "/recommendations?api_key=3daaa224d520ad43baab7a6b2c604dca&language=en-US&page=1", false);
            xhr.send();
            console.log(xhr.status); // if this returns 200, then you are in like Flynn
            var movieDiscover = JSON.parse(xhr.responseText);
            
            $("#related").text(movieDiscover.results["0"].original_title);
            $("#relatedimg").attr("src", imageurlsmall + movieDiscover.results["0"].poster_path);
            $("#related1").text(movieDiscover.results["1"].original_title);
            $("#related1img").attr("src", imageurlsmall + movieDiscover.results["1"].poster_path);
            $("#related2").text(movieDiscover.results["2"].original_title);
            $("#related2img").attr("src", imageurlsmall + movieDiscover.results["2"].poster_path);
            $("#related3").text(movieDiscover.results["3"].original_title);
            $("#related3img").attr("src", imageurlsmall + movieDiscover.results["3"].poster_path);
            $("#related4").text(movieDiscover.results["4"].original_title);
            $("#related4img").attr("src", imageurlsmall + movieDiscover.results["4"].poster_path);
        }
       
        function getMovie(input) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://api.themoviedb.org/3/search/movie?api_key=3daaa224d520ad43baab7a6b2c604dca&query=" + input, false);
            xhr.send();
            console.log(xhr.status); // if this returns 200, then you are in like Flynn
            var movieObject = JSON.parse(xhr.responseText);
            console.log(movieObject);
            
            $("main").show();
            $("#nowplaying").hide();
            $("#movietitle").text(movieObject.results["0"].original_title);
            $("#poster").attr("src", urlimglarge + movieObject.results["0"].poster_path);
            $("#date").text(movieObject.results["0"].release_date);
            $("#overview").text(movieObject.results["0"].overview);
            $("#language").text(movieObject.results["0"].original_language);
            $("#popularity").text(movieObject.results["0"].vote_average);
            $("#genre").text(movieObject.results["0"].genre_ids);
            
            recommendMovie(movieObject);
        }
        
    </script> 
</head>

<body>
    
<header>
    <h1>Movie Database API</h1>
</header>
    
<!--Now Playing-->   
<section id="nowplaying" class="section group">
    <h2>Now Playing</h2>
    <p class="col span_2_of_12"> 
    <img id="popularimg" src="" href="">
    <span id="popular"></span>
    </p>
    <p class="col span_2_of_12"> 
    <img id="popular1img" src="" href="">
    <span id="popular1"></span>
    </p>
    <p class="col span_2_of_12"> 
    <img id="popular2img" src="" href="">
    <span id="popular2"></span>
    </p>
    <p class="col span_2_of_12"> 
    <img id="popular3img" src="" href="">
    <span id="popular3"></span>
    </p>
    <p class="col span_2_of_12"> 
    <img id="popular4img" src="" href="">
    <span id="popular4"></span>
    </p>
</section>

<!--Search form-->
<p>Search for a Movie:</p>
 <input type="text" name="title" id="search">
 <button onclick="getMovie(getInput());">Search for movie by title</button>
    
<main>
<h2 id="movietitle">Title- N/A</h2>

<img id="poster" src= " ">
Date:
<p id="date"></p>
Overview:
<p id="overview"></p>
Language: 
<p id="language"></p>
Popularity:  
<p id="popularity"></p>
Genre(s):  
<p id="genre"></p>
</main>

<section id="recommended" class="section group">
    <p class="col span_2_of_12"> 
    <img id="relatedimg" src="" href="">
    <span id="related"></span>
    </p>
    <p class="col span_2_of_12">
    <img id="related1img" src="" href="">
    <span id="related1"></span>
    </p>
    <p class="col span_2_of_12"> 
    <img id="related2img" src="" href="">
    <span id="related2"></span>
    </p>
    <p class="col span_2_of_12"> 
    <img id="related3img" src="" href="">
    <span id="related3"></span>
    </p>
    <p class="col span_2_of_12"> 
    <img id="related4img" src="" href="">
    <span id="related4"></span>
    </p>
</section>
    
<footer>
    All information comes from the TMBD API.

    <copyright>
        This is the copyright.
    </copyright>
</footer>
    

    
</body>
    
<script>

$(window).on( "load", function() {
        nowPlaying();
        $("main").hide();
    });
    
</script>

</html>